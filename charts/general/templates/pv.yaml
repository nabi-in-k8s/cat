{{ $fullName := include "general.fullname" . }}
{{ $namespace := include "general.namespace" . }}
{{ $labels := include "general.labels" . }}
{{ $affinity := .Values.affinity | toYaml | nindent 4 }}

{{ range .Values.persistentVolumes }}
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: {{ $fullName }}
  namespace: {{ $namespace }}
  labels:
    {{- $labels | nindent 4 }}
  annotations: {{- .annotations | toYaml | nindent 4 }}
spec:
  storageClassName: {{ $fullName }}
  persistentVolumeReclaimPolicy: {{ .reclaimPolicy }}
  accessModes: {{ .accessModes | toJson | nindent 4 }}
  local:
    path: {{ .path }}
  capacity:
    storage: {{ .size }}
  nodeAffinity: {{- $affinity }}
{{ end }}